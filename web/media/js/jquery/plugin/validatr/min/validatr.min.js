/*! Validatr - v0.3.0 - 2013-02-20
* http://jaymorrow.github.com/validatr/
* Copyright (c) 2013 Jay Morrow; Licensed MIT */
(function(e,t,a,i){"use strict";function r(e,t){if(this.el=e,this.$el=a(e),!this.$el.length||!this.$el.is("form"))throw Error(P+" needs a form to work.");this.isSubmit=!1,this.firstError=!1,this.options=a.extend({},a.fn[P].defualtOptions,t),this.options.template=a(this.options.template).addClass($.base+$[this.options.theme])[0].outerHTML,this.elements=this.getElements(this.el).on("valid."+P,a.proxy(f,this)).on("invalid."+P,a.proxy(c,this)),this.el.noValidate=!0,this.$el.on("submit."+P,a.proxy(d,this)),this.$el.on("reset."+P,a.proxy(p,this))}function s(){this.elements.on({"focus.validatrelement":o,"blur.validatrelement":l}),a("input[type=radio], input[type=checkbox]").on("click.validatrelement",function(e){u(e.target)})}function n(){this.elements.off(".validatrelement")}function o(e){var t=e.target,i=t;"select"===t.nodeName.toLowerCase()&&i.on("change.validatrinput",function(){setTimeout(function(){u(t)},1)}),a(t).on({"blur.validatrinput":function(){u(t)},"keyup.validatrinput":function(e){t.value.length&&-1===w(x,e.keyCode)&&u(t)}})}function l(e){a(e.target).off(".validatrinput")}function u(e){if("radio"===e.type){var i=a(t.getElementsByName(e.name)).filter("[required]");i.length&&(e=i[0])}var r=a(e),s=e.getAttribute("type"),n=g.attributes.required?e.required:a(e).is("[required]"),o={valid:!0,message:""};if(g.inputtypes[s]&&e.checkValidity?(o.valid=e.validity.valid,o.message=e.validationMessage):(n&&(o=y.required(e)),o.valid&&e.value.length&&!v.boxes.test(s)&&(e.pattern&&(s="pattern"),y[s]&&(o=y[s](e)))),o.valid)for(var l in b)if(b.hasOwnProperty(l)&&r.is("[data-"+l+"]")&&(o=b[l](e),!o.valid))break;return o.valid?(r.trigger("valid"),!0):(a.data(e,"validationMessage",o.message),r.trigger("invalid"),!1)}function m(e){var t=!0;return e.each(function(e,a){u(a)||(t=!1)}),t}function d(){this.isSubmit=!0,p.call(this);var e=m(this.elements);return e?this.options.valid.call(this.el,this.el):(s.call(this),this.isSubmit=!1,e)}function p(){n.call(this),this.firstError=!1,this.elements.next(".validatr-message").remove()}function c(e){if(!F){e.preventDefault();var t=e.target,r=a(t),s=this.options,n=t.getAttribute("data-message")||a.data(t,"validationMessage"),o=a(s.template.replace("{{message}}",n));return this.isSubmit&&!this.firstError?(this.firstError=r.after(o),s.position.call(this,o,r),i):((!this.isSubmit||s.showall)&&(f(e),r.after(o),s.position.call(this,o,r)),i)}}function f(e){F||a(e.target).next(".validatr-message").remove()}function h(e,t){e.css("position","absolute");var a=t.offset(),i=t[0].getAttribute("data-location")||this.options.location;v.topbottom.test(i)?(e.offset({left:a.left}),"top"===i&&e.offset({top:a.top-e.outerHeight()-2}),"bottom"===i&&e.offset({top:a.top+e.outerHeight()})):v.leftright.test(i)&&(e.offset({top:a.top+t.outerHeight()/2-e.outerHeight()/2}),"left"===i&&e.offset({left:a.left-e.outerWidth()-2}),"right"===i&&e.offset({left:a.left+t.outerWidth()+2}))}var g=function(){var e={},a=t.documentElement,r=":)",s=t.createElement("input"),n={};return e.attributes={multiple:!!("multiple"in s),required:!!("required"in s)},e.inputtypes=function(e){for(var o,l,u,m=0,d=e.length;d>m;m++)s.setAttribute("type",l=e[m]),o="text"!==s.type,o&&(s.value=r,s.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(l)&&s.style.WebkitAppearance!==i?(a.appendChild(s),u=t.defaultView,o=u.getComputedStyle&&"textfield"!==u.getComputedStyle(s,null).WebkitAppearance&&0!==s.offsetHeight,a.removeChild(s)):/^(search|tel)$/.test(l)||(o=/^(url|email)$/.test(l)?s.checkValidity&&s.checkValidity()===!1:s.value!==r)),n[e[m]]=!!o;return n.text=!0,n.password=!0,n}("search tel url email datetime date month week time datetime-local number range color".split(" ")),s=null,e}(),v={boxes:/checkbox|radio/i,color:/^#[0-9A-F]{6}$/i,date:{dd:"(0[1-9]|[12][0-9]|3[01])",mm:"(0[1-9]|1[012])",yyyy:"(\\d{4})"},email:/^[a-zA-Z0-9.!#$%&â€™*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,isoDate:/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,leftright:/left|right/i,separators:/(\/|\-|\.)/g,separatorsNoGroup:/\/|\-|\./g,time:/^([01][0-9]|2[0-3])(:([0-5][0-9])){2}$/,topbottom:/top|bottom/i,url:/^\s*https?:\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?\s*$/},y={checkbox:function(e){return{valid:e.checked,message:a[P].messages.checkbox}},color:function(e){return{valid:v.color.test(e.value),message:a[P].messages.color}},date:function(e){var t=a(e),i=g.inputtypes.date?E(e.value):k(e),r=t.attr("min")?E(t.attr("min")):!1,s=t.attr("max")?E(t.attr("max")):!1,n=isNaN(t.attr("step"))?!1:parseInt(t.attr("step"),10);return N.call(e,i,r,s,n,"date")},email:function(e){var t=!0,r=a[P].messages.email.single,s=g.attributes.multiple?e.multiple:a(e).is("[multiple]");if(s){var n=e.value.split(",");a.each(n,function(e,s){return v.email.test(s)?i:(t=!1,r=a[P].messages.email.multiple,i)})}else t=v.email.test(e.value);return{valid:t,message:r}},number:function(e){var t=a(e),i=isNaN(parseFloat(e.value))?!1:parseFloat(e.value),r=i!==!1?isNaN(t.attr("min"))?!1:parseFloat(t.attr("min")):!1,s=i!==!1?isNaN(t.attr("max"))?!1:parseFloat(t.attr("max")):!1,n=i!==!1?isNaN(t.attr("step"))?!1:parseFloat(t.attr("step")):!1;return n!==!1&&r===!1&&(r=0),N.call(e,i,r,s,n,"number")},pattern:function(e){return{valid:RegExp(e.pattern).test(e.value),message:a[P].messages.pattern}},radio:function(e){return{valid:a(t.getElementsByName(e.name)).is(":checked"),message:a[P].messages.radio}},range:function(e){return this.number(e)},required:function(e){return v.boxes.test(e.type)?this[e.type](e):{valid:e.value.length,message:"select"===e.nodeName.toLowerCase()?a[P].messages.select:a[P].messages.required}},time:function(e){return{valid:v.time.test(e.value),message:a[P].messages.time}},url:function(e){return{valid:v.url.test(e.value),message:a[P].messages.url}}},b={as:function(e){if("text"!==e.type)throw Error("element must have a type of text");var t=e.getAttribute("data-as");return y[t]?y[t](e):i},match:function(e){var i=e.getAttribute("data-match"),r=t.getElementById(i)||t.getElementsByName(i)[0];return r?(a(r).off("valid.validatrinput").on("valid.validatrinput",function(){e.value===r.value&&u(e)}),{valid:e.value===r.value,message:"'"+e.name+"' does not equal '"+r.name+"'"}):{valid:!1,message:"'"+i+"' can not be found"}}},x=[16,17,18,19,20,33,34,35,36,37,39],w=function(e,t){for(var a=-1,i=e?e.length:0;i>++a;)if(e[a]===t)return a;return-1},k=function(e){var t=e.getAttribute("data-format")||S,a=t.split(v.separatorsNoGroup),i=e.value.split(v.separatorsNoGroup),r="yyyy-mm-dd".split("-"),s=t.replace(v.separators,"\\$1").replace("yyyy",v.date.yyyy).replace("mm",v.date.mm).replace("dd",v.date.dd),n=-1,o=r.length,l=[];if(s=RegExp(s),!s.test(e.value))return!1;for(;o>++n;)l[n]=i[w(a,r[n])];return E(l.join("-"))},E=function(e){if(!v.isoDate.test(e))return!1;var t=v.isoDate.exec(e);return new Date(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10))},q=function(e,t){var a=e.getDate(),i=e.getMonth()+1,r=e.getFullYear(),s=(t.getAttribute("data-format")||S).replace("mm",i).replace("yyyy",r).replace("dd",a);return s},N=function(e,t,i,r,s){var n=!0,o=a[P].messages.range.base,l=t,u=i;return"date"===s&&(l=t&&q(t,this),u=i&&q(i,this)),e!==!1&&(t!==!1&&i!==!1?(n=e>=t&&i>=e,o=a[P].messages.range.gtelte):t!==!1?(n=e>=t,o=a[P].messages.range.gte):i!==!1&&(n=i>=e,o=a[P].messages.range.lte),n&&r!==!1&&(n=0===(e-t)%r,o=a[P].messages.range.invalid)),{valid:e!==!1&&n,message:o.replace("{{type}}",s).replace("{{min}}",l).replace("{{max}}",u)}},A=function(e){return e instanceof jQuery&&(e=e[0]),e},P="validatr",$={base:P+"-message ",bootstrap:"alert alert-error",jqueryui:"ui-state-error ui-corner-all",none:P+"-error"},C="button, input[type=submit], input[type=button], input[type=reset]",F=!1,S="mm/dd/yyyy",D=function(){};D.prototype={addTest:function(e){var t="string"!=typeof e,i=Array.prototype.slice.call(arguments,1)[0];if(t)a.extend(b,e);else{if(!i)throw Error("You must include a callback function");b[e]=i}},getElements:function(e){if(this.elements)return this.elements;var t=a(e).map(function(){return this.elements?a.makeArray(this.elements):a.makeArray(a(this).find("input, textarea, select"))}).not(C);return e.id&&(t=t.add(a('[for="'+e.id+'"]'))),t},validateElement:function(e){if(!e)throw Error("method requires an element");F=!0;var t=u(A(e));return F=!1,t},validateForm:function(e){var t,a=this.el||A(e);if("form"!==a.nodeName.toLowerCase())throw Error("you must pass a form to this method");return F=!0,t=m(this.elements||this.getElements(a)),F=!1,t}},a.fn[P]=function(e){var t,s="string"==typeof e,n=Array.prototype.slice.call(arguments,1),o=this;if(s)this.each(function(){var r;if(t=a.data(this,P),!t)throw Error("cannot call methods on "+P+" prior to initialization; attempted to call method '"+e+"'");if(!a.isFunction(t[e]))throw Error("no such method '"+e+"' for "+P+" widget instance");return r=t[e].apply(t,n),r!==t&&r!==i?(o=r&&r.jquery?o.pushStack(r.get()):r,!1):i});else{var l;this.each(function(){t=a.data(this,P),t||(l=new D,r.call(l,this,e||{}),a.data(this,P,l))})}return o},a.fn[P].defualtOptions={customMessages:!1,location:"right",position:h,showall:!1,template:"<div>{{message}}</div>",theme:"none",valid:a.noop},a[P]=new D,a[P].messages={checkbox:"Please check this box if you want to proceed.",color:"Please enter a color in the format #xxxxxx",email:{single:"Please enter an email address.",multiple:"Please enter a comma separated list of email addresses."},pattern:"Please match the requested format.",radio:"Please select one of these options.",range:{base:"Please enter a {{type}}",gte:"Please enter a {{type}} greater than or equal to {{min}}.",gtelte:"Please enter a {{type}} greater than or equal to {{min}}<br> and less than or equal to {{max}}.",invalid:"Invalid {{type}}",lte:"Please enter a {{type}} less than or equal to {{max}}."},required:"Please fill out this field.",select:"Please select an item in the list.",time:"Please enter a time in the format hh:mm:ss",url:"Please enter a url."},a.expr[":"][P]=function(e){return e.textContent.indexOf(P)>=0}})(this,this.document,jQuery);